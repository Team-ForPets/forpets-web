FROM node AS build
WORKDIR /app

ARG API_URL
ENV API_URL=${API_URL}

ARG DOMAIN
ENV DOMAIN=${DOMAIN}

ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}

ARG VITE_KAKAOMAP_KEY
ENV VITE_KAKAOMAP_KEY=${VITE_KAKAOMAP_KEY}

ARG VITE_KAKAO_REST_KEY
ENV VITE_KAKAO_REST_KEY=${VITE_KAKAO_REST_KEY}

ARG VITE_RESCUE_ANIMALS_KEY
ENV VITE_RESCUE_ANIMALS_KEY=${VITE_RESCUE_ANIMALS_KEY}

ARG VITE_DOMAIN
ENV VITE_DOMAIN=${VITE_DOMAIN}
ARG VITE_SOCIAL_LOGIN_DOMAIN
ENV VITE_SOCIAL_LOGIN_DOMAIN=${VITE_SOCIAL_LOGIN_DOMAIN}

COPY package.json package-lock.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
COPY ./templates /etc/nginx/templates

EXPOSE 80 443
CMD ["nginx", "-g", "daemon off;"] 
